!function(e){"function"==typeof define&&define.amd?define(["fs"],e):e()}((function(){"use strict";class e{static i=1;static o=2;static u=3;static p=4;static R=5;static T=6;static $=7;static I=8;static P=9;static k=10;static O=11;static _=12;static A=13;static N=14;static S=15;static U=16;static Y=17;static M=18;constructor(e,t,r,n){this.type=e,this.name=t,this.value=r,this.position=n}}class t{static D=18;static PI=new t("3.141592653589793238");static#e=BigInt("1"+"0".repeat(t.D));static#t=new RegExp("\\.?0+$");#r;constructor(e=0){let r,n;e instanceof t?this.#r=e.#r:e instanceof BigInt?this.#r=value*t.L:([r,n]=(e+".").split("."),this.#r=BigInt(r+n.substr(0,t.D).padEnd(t.D,"0")),n.charCodeAt(t.D)>52&&this.#r++)}#n(e){let r;return r=new t(this),r.#r=e,r}#i(e,t){return this.#n(e/t+2n*e/t%2n)}add(e){return this.#n(this.#r+new t(e).#r)}C(e){return this.#n(this.#r-new t(e).#r)}B(e){return this.#i(this.#r*new t(e).#r,t.#e)}F(e){return this.#i(this.#r*t.#e,new t(e).#r)}equals(e){return this.valueOf()==e}valueOf(){return this.#r}W(){return+this.toString()}toString(e=t.D){let r;return r=this.#i(this.#r,BigInt("1"+"0".repeat(e>-1?Math.max(t.D-e,0):t.D))).#r.toString().padStart(e+1,"0"),r.substr(0,r.length-e)+("."+r.substr(-e)).replace(t.#t,"")}}class r{static X=1;static V=2;static G=3;static H=4;static K=5;static Z(){return{stack:[],j:[],J:null,pending:0,x:new t(0),y:new t(0),ee:!1,te:null,re:new t(0),ne:new t(0)}}}class n{static#a=[{type:e.i,ie:new RegExp("^[0-9]*\\.?[0-9]+",""),ae:e=>new t(e)},{type:e.o,ie:new RegExp("^[achlmqstvz](?![a-z_$])","i"),ae:e=>({a:[r.X,r.V,r.G,r.H,r.H,r.X,r.V],c:[r.X,r.V,r.X,r.V,r.X,r.V],h:[r.X],l:[r.X,r.V],m:[r.X,r.V],q:[r.X,r.V,r.X,r.V],s:[r.X,r.V,r.X,r.V],t:[r.X,r.V],v:[r.V],z:[]}[e.toLowerCase()])},{type:e.u,ie:new RegExp("^,+",""),ae:()=>null},{type:e.p,ie:new RegExp("^\\s+",""),ae:()=>null},{type:e.R,ie:new RegExp("^[a-z_$][a-z0-9_$]*","i"),ae:e=>e},{type:e.T,ie:new RegExp("^[()]",""),ae:e=>"("===e},{type:e.I,ie:new RegExp("^\\+",""),ae:e=>e},{type:e.k,ie:new RegExp("^\\*",""),ae:e=>e},{type:e.P,ie:new RegExp("^-",""),ae:e=>e},{type:e.O,ie:new RegExp("^/",""),ae:e=>e},{type:e._,ie:new RegExp("^%r",""),ae:e=>e},{type:e.A,ie:new RegExp("^%h",""),ae:e=>e},{type:e.N,ie:new RegExp("^%v",""),ae:e=>e},{type:e.S,ie:new RegExp("^@",""),ae:e=>e},{type:e.U,ie:new RegExp("^\\|",""),ae:e=>e},{type:e.Y,ie:new RegExp("^=",""),ae:e=>e},{type:e.M,ie:new RegExp("^#",""),ae:e=>e}];#s=null;#o=0;constructor(t){var r,i,a,s;for(this.#s=[],i=0;t.length;){for(r=0;r<n.#a.length;r++)if(a=(s=n.#a[r]).ie.exec(t)){this.#s.push(new e(s.type,a[0],s.ae(a[0]),i)),i+=a[0].length,t=t.substr(a[0].length);break}if(r===n.#a.length)throw new SyntaxError(`Unexpected symbol "${t.substr(0,1)}" at column ${i}`)}this.#s.push(new e(e.$,null,null,i))}se(){return this.#s[this.#o]??null}oe(){return this.#o++,this.se()}ce(){return this.#s[this.#o+1]??null}reset(){return this.#o=0,this.se()}}class i{static le=0;static he=1;static ue=2;static fe=3;static#c(e,t,r,n,i){var a,s;return r=r.C(e),n=n.C(t),i=i.W()%360*Math.PI/180,a=Math.cos(i),s=Math.sin(i),Math.abs(a-s)<2*Number.EPSILON?s=a:Math.abs(a+s)<2*Number.EPSILON&&(a=s),Math.abs(a)<Number.EPSILON&&(a=0),Math.abs(s)<Number.EPSILON&&(s=0),{x:e.add(r.B(a)).C(n.B(s)),y:t.add(n.B(a)).add(r.B(s))}}static#l(e,t,r,n,a,s){a===i.fe?e.x=r.value:r.fixed&&(e.x=t?r.value.C(s.x):r.value),a===i.ue?e.y=n.value:n.fixed&&(e.y=t?n.value.C(s.y):n.value)}static we(e,r,n,a,s){let o,c,l,h,u,f,w,p;if(l=r[0].toLowerCase(),h=r[0].toLowerCase()===r[0],o={x:h?new t(0):n.x,y:h?new t(0):n.y},n.pending)throw new SyntaxError(`Too few arguments for command ${r[0]}`);if(n.ee)throw new SyntaxError(`Dangling fix operator after command ${r[0]}`);switch(l){case"a":c={x:r[6].value,y:r[7].value},a!==i.le&&(c=i.#c(o.x,o.y,c.x,c.y,s)),i.#l(c,h,r[6],r[7],a,n),r=[r[0],r[1].value,r[2].value,r[3].fixed?r[3].value:r[3].value.add(s),r[4].value,r[5].value,c.x,c.y];break;case"c":u={x:r[1].value,y:r[2].value},f={x:r[3].value,y:r[4].value},c={x:r[5].value,y:r[6].value},a!==i.le&&(u=i.#c(o.x,o.y,u.x,u.y,s),f=i.#c(o.x,o.y,f.x,f.y,s),c=i.#c(o.x,o.y,c.x,c.y,s)),i.#l(c,h,r[5],r[6],a,n),r=[r[0],r[1].fixed?h?r[1].value.C(n.x):r[1].value:u.x,r[2].fixed?h?r[2].value.C(n.y):r[2].value:u.y,r[3].fixed?h?r[3].value.C(n.x):r[3].value:f.x,r[4].fixed?h?r[4].value.C(n.y):r[4].value:f.y,c.x,c.y];break;case"s":case"q":u={x:r[1].value,y:r[2].value},c={x:r[3].value,y:r[4].value},a!==i.le&&(u=i.#c(o.x,o.y,u.x,u.y,s),c=i.#c(o.x,o.y,c.x,c.y,s)),i.#l(c,h,r[3],r[4],a,n),r=[r[0],u.x,u.y,c.x,c.y];break;case"l":case"h":case"v":let d="v"===l?{value:new t(o.x),fixed:r[1].fixed}:r[1],m="h"===l?{value:new t(o.y),fixed:r[1].fixed}:"v"===l?r[1]:r[2];c={x:d.value,y:m.value},a!==i.le&&(c=i.#c(o.x,o.y,c.x,c.y,s)),p=180*Math.atan2(c.y.C(o.y).W(),c.x.C(o.x).W())/Math.PI,i.#l(c,h,d,m,a,n),(r=c.x.equals(o.x)?c.y.equals(o.y)?null:["v",c.y]:c.y.equals(o.y)?["h",c.x]:["l",c.x,c.y])&&(e.de.path.pe&&n.j.length>0&&(w=n.j[n.j.length-1],w[0].toLowerCase()===r[0].toLowerCase()&&p===n.te&&(h?(w.length>2&&(w[2]=w[2].add(r[2])),w[1]=w[1].add(r[1]),r=null):n.me.pop())),n.te=p);break;case"m":case"t":c={x:r[1].value,y:r[2].value},a!==i.le&&(c=i.#c(o.x,o.y,c.x,c.y,s)),i.#l(c,h,r[1],r[2],a,n),r=[r[0],c.x,c.y],e.de.path.pe&&"m"===l&&n.j.length>0&&(w=n.j[n.j.length-1],"m"===w[0].toLowerCase()&&(h?(w[1]=w[1].add(r[1]),w[2]=w[2].add(r[2]),r=null):n.me.pop()));break;case"z":r=["z"],n.x=new t(n.re),n.y=new t(n.ne),n.te=null}"z"!==l&&(n.x=h?n.x.add(c.x):c.x,n.y=h?n.y.add(c.y):c.y),"m"===l&&(n.re=new t(n.x),n.ne=new t(n.y)),r&&(h||(r[0]=r[0].toUpperCase()),n.j.push(r))}}class a{constructor(e){this.stream=e}static Ee(e,r=t.D){return e.j.map((e=>e[0].toString()+(e.length>1?" "+e.slice(1).join(","):""))).join(" ")}xe(t,n=r.Z(),i=-1){let a;for(a={ye:this.stream.se(),ge:!0,index:0};a.ge&&a.ye&&(a.index<i||-1===i);){switch(a.ye.type){case e.p:case e.u:break;case e.$:a.ge=!1;break;default:let i=new s(this.stream).parse(t,0,[],!1,{x:n.x,y:n.y},r.K);n.j.push([i.accumulator]),n.index++,a.ye=this.stream.se();continue}a.ye=this.stream.oe()}return n}parse(n,a=r.Z(),o=i.le,c=new t(0),l=1,h){let u,f,w,p;for(u={ye:this.stream.se(),ge:!0};u.ge&&u.ye;){switch(u.ye.type){case e.o:if(null===a.J&&"m"!==u.ye.name.toLowerCase())throw new SyntaxError("Paths must begin with a Move To command");f&&i.we(n,f,a,o,c),a.J=u.ye.value,a.pending=a.J.length,f=[u.ye.name];break;case e.S:a.ee=!0;break;case e.p:case e.u:break;case e.$:f&&i.we(n,f,a,o,c),u.ge=!1;break;case e.R:case e.i:if(u.ye.type===e.i?(p=this.stream.ce(),w=p.type===e.R&&n.be[p.name]):w=n.be[u.ye.name],w){f&&(i.we(n,f,a,o,c),f=null),new s(this.stream).Re(n,a,h),u.ye=this.stream.se();continue}default:if(!f)throw new Error(`Expected command, but found "${u.ye.name}"`);if(a.pending||(i.we(n,f,a,o,c),a.pending=a.J.length,f=[f[0]]),!a.pending)throw new SyntaxError(`Too many parameters supplied to command "${f[0]}"`);if("a"===f[0].toLowerCase()&&(4===a.pending||3===a.pending)&&u.ye.type===e.i&&u.ye.name.length>1&&-1!==["0","1"].indexOf(u.ye.name.substr(0,1)))f.push({fixed:a.ee,value:new t(u.ye.name.substr(0,1))}),u.ye.name=u.ye.name.substr(1),u.ye.value=new t(u.ye.name);else if(u.ye.type===e.i?(p=this.stream.ce(),w=p.type===e.R&&n.be[p.name]):w=n.be[u.ye.name],!w){let e=new s(this.stream).parse(n,0,h,!1,{x:a.x,y:a.y},a.J[a.J.length-a.pending]);f.push({fixed:a.ee,value:e.accumulator})}a.ee=!1,a.pending--,u.ye=this.stream.se();continue}u.ye=this.stream.oe()}return a}}class s{static#h=1;static#u=2;static#f=3;static#w=4;static#p=5;constructor(e){this.stream=e,this.debug=!1}static#d(e){return e.value+" "+["","=","+","-","*","/"][e.operation]}static#m(e,t){var r,n,i;for(r=e.stack.length-1;r>-1&&e.stack[r].operation>t;)r--;if((n=r+1)<e.stack.length){for(e.stack.push({operation:s.#h,value:e.accumulator}),this.debug&&console.log("<<\n"+e.stack.slice(n).map(((e,t)=>t+": "+s.#d(e))).join("\n")),i=e.stack[n].value;n<e.stack.length-1;n++)switch(e.stack[n].operation){case s.#w:i=i.B(e.stack[n+1].value);break;case s.#p:i=i.F(e.stack[n+1].value);break;case s.#u:i=i.add(e.stack[n+1].value);break;case s.#f:i=i.C(e.stack[n+1].value)}e.accumulator=i,e.stack=e.stack.slice(0,r+1)}}parse(n,i=0,a={},o=!1,c,l,h=[]){var u,f;for(u={accumulator:new t(0),Te:0,$e:i,data:0,stack:[]},f={ye:this.stream.se(),ge:!0};f.ge&&f.ye;){switch(f.ye.type){case e.i:if(u.data===e.p)throw new SyntaxError(`Unexpected space-delimited value "${f.ye.name}" at column ${f.ye.position}`);if(u.data===e.i){if(u.$e)throw new SyntaxError(`Unexpected token "${f.ye.name}" at column ${f.ye.position}`);f.ge=!1;continue}this.debug&&console.log("Number",f.ye),u.accumulator=f.ye.value,u.data=e.i;break;case e.O:if(u.data!==e.i&&u.data!==e.p)throw new SyntaxError(`Unexpected token "${f.ye.name}" at column ${f.ye.position}`);this.debug&&console.log("/",f.ye),u.stack.push({operation:s.#p,value:u.accumulator}),u.data=e.O;break;case e.k:if(u.data!==e.i&&u.data!==e.p)throw new SyntaxError(`Unexpected token "${f.ye.name}" at column ${f.ye.position}`);this.debug&&console.log("*",f.ye),u.stack.push({operation:s.#w,value:u.accumulator}),u.data=e.k;break;case e.P:if(u.data===e.i&&0===u.$e){f.ge=!1;continue}if(u.data!==e.i&&0!==u.data&&u.data!==e.T&&u.data!==e.p)throw new SyntaxError(`Unexpected token "${f.ye.name}" at column ${f.ye.position}`);this.debug&&console.log("-",f.ye),s.#m(u,s.#f),u.stack.push({operation:s.#f,value:u.accumulator}),u.data=e.P;break;case e.I:if(u.data!==e.i&&u.data!==e.p)throw new SyntaxError(`Unexpected token "${f.ye.name}" at column ${f.ye.position}`);this.debug&&console.log("+",f.ye),s.#m(u,s.#f),u.stack.push({operation:s.#u,value:u.accumulator}),u.data=e.I;break;case e.U:if(u.data===e.p)throw new SyntaxError(`Unexpected space before measure operator ("${f.ye.name}") at column ${f.ye.position}`);if(u.data===e.i&&(this.debug&&console.log("*",f.ye),u.stack.push({operation:s.#w,value:u.accumulator})),l===r.K)throw new SyntaxError("The unit type is incompatible with the return value of a segment measurement");if(l===r.H)throw new SyntaxError("The flag type is incompatible with the return value of a segment measurement");if(this.stream.oe(),this.stream.se().type===e.p&&this.stream.oe(),this.stream.se().type!==e.R)throw new SyntaxError(`Expected identifier at ${this.stream.se().position}, found "${this.stream.se().name}"`);let i=r.Z();switch(i.x=c.x,i.y=c.y,i.J=[],new s(this.stream).Re(n,i,a),u.data=e.i,l){case r.X:u.accumulator=i.x.C(c.x),console.log("RETURNING X",u.accumulator.toString());break;case r.V:u.accumulator=i.y.C(c.y),console.log("RETURNING Y",u.accumulator.toString());break;case r.G:u.accumulator=new t(Math.atan2(i.x.C(c.x).W(),i.y.C(c.y).W())).B(180).F(t.PI),console.log("RETURNING THETA",u.accumulator.toString())}if(this.stream.se().type===e.p&&this.stream.oe(),f.ye=this.stream.se(),f.ye.type!==e.U)throw new SyntaxError(`Expected measurement operator, found "${f.ye.name}`);break;case e.T:if(this.debug&&console.log(f.ye.value?"(":")",f.ye,u.$e,n.Ie),f.ye.value){if(u.data===e.p)throw new SyntaxError(`Unexpected token "${f.ye.name}" at column ${f.ye.position}`);u.$e++,u.data===e.i&&(this.debug&&console.log("*",f.ye),u.stack.push({operation:s.#w,value:u.accumulator})),u.accumulator=new t(0),u.stack.push({operation:s.#h}),u.data=e.T}else{if(!o&&u.$e===n.Ie)throw new SyntaxError(`Mismatched bracket at column ${f.ye.position}`);if(u.data!==e.i)throw new SyntaxError(`Unexpected bracket at column ${f.ye.position}`);if(s.#m(u,s.#h),u.stack.pop(),u.data=e.i,o){f.ge=!1;continue}u.$e--}break;case e.R:if(u.data===e.p)throw new SyntaxError(`Unexpected space-delimited value "${f.ye.name}" at column ${f.ye.position}`);if(!(f.ye.name in a)&&!(f.ye.name in n.unit))throw new ReferenceError(`Reference to undefined unit "${f.ye.name}" at column ${f.ye.position}.`);u.data===e.i&&(this.debug&&console.log("*",f.ye),u.stack.push({operation:s.#w,value:u.accumulator})),this.debug&&console.log("Unit",f.ye),u.accumulator=a[f.ye.name]??n.unit[f.ye.name],u.data=e.i;break;case e.u:if(u.$e)throw new SyntaxError(`Unexpected delimiter "${f.ye.name}" in expression at column ${f.ye.position}.`);case e.p:if(u.$e||0===u.data){u.data===e.i&&(u.data=e.p);break}case e.$:if(u.$e>n.Ie)throw new SyntaxError(`Missing closing bracket(s) at end of segment (nesting depth = ${u.$e-n.Ie})`);f.ge=!1;continue;default:if(h.includes(f.ye.type)){f.ge=!1;continue}throw new SyntaxError(`Unexpected token "${f.ye.name}" at column ${f.ye.position}`)}f.ye=this.stream.oe()}return s.#m(u,s.#f),s.#m(u,0),u}Re(o,c,l){let h,u,f,w,p,d,m;if(h={ye:this.stream.se(),ge:!0,Pe:!1,ke:!1,Oe:new t(0),ve:i.le,count:!1,_e:{},Ae:!1},h.ye.type===e.i?(h.count=h.ye.value.W(),h.Pe=!0,h.ye=this.stream.oe()):h.count=1,w=h.ye.name,-1!==c.stack.indexOf(w))throw new ReferenceError(`Segment ${h.ye.name} cannot call itself`);{if(!(w in o.be))throw new ReferenceError(`Reference to undefined section "${w}" at ${h.ye.position}`);u=o.be[w];const t=w;for(h.ye=this.stream.oe();!0===h.ge&&h.ye;){switch(h.ye.type){case e._:case e.A:case e.N:if(h.ve!==i.le)throw new Error(`Encountered distortion operator, but distortion for segment "${w}" is already specified (parameter value: ${h.Oe})`);this.stream.oe(),d=new s(this.stream).parse(o,0,l,!1,{x:c.x,y:c.y},r.G,[e._,e.A,e.N]),h.Oe=d.accumulator,h.ve={[e._]:i.he,[e.A]:i.ue,[e.N]:i.fe}[h.ye.type],h.ye=this.stream.se();continue;case e.T:if(h.ke){h.ge=!1;continue}if(!h.ye.value)throw new SyntaxError(`Unexpected token "${h.ye.name}" at column ${h.ye.position}`);for(h.ye=this.stream.oe();!h.ke;){switch(h.ye.type){case e.T:if(h.ye.value)throw new SyntaxError(`Unexpected token "${h.ye.name}" at column ${h.ye.position}`);h.ke=!0;continue;case e.R:case e._:case e.M:case e.A:case e.N:switch(h.Ae=!1,w=h.ye.name,m=h.ye.type,m){case e.R:if(o.be[w])throw new ReferenceError(`Argument "${w}" is already defined as a segment`);break;case e._:case e.A:case e.N:if(h.ve!==i.le)throw new Error(`Encountered distortion operator, but distortion for segment "${t}" is already specified (parameter value: ${h.Oe})`);break;case e.M:if(h.Pe)throw new ReferenceError("Execution count is already defined for this invocation")}if(this.stream.ce().type===e.p&&(h.ye=this.stream.oe()),h.ye=this.stream.oe(),h.ye.type===e.$)throw new Error(`Unexpected end of segment at ${h.ye.position}`);if(h.ye.type!==e.Y)throw new SyntaxError(`Expected assignment operator after argument name, but found "${h.ye.name}"`);switch(h.ye=this.stream.oe(),d=new s(this.stream).parse(o,0,l,!0,{x:c.x,y:c.y},{[e.R]:r.K,[e._]:r.G,[e.A]:r.G,[e.N]:r.G,[e.M]:r.K}[m]),m){case e.R:h._e[w]=d.accumulator;break;case e._:case e.A:case e.N:h.Oe=d.accumulator,h.ve={[e._]:i.he,[e.A]:i.ue,[e.N]:i.fe}[m];break;case e.M:h.count=d.accumulator.W(),h.Pe=!0}h.ye=this.stream.se();continue;case e.u:if(h.Ae)throw new Error(`Unexpected delimiter at column ${h.ye.position}`);h.Ae=!0;case e.p:break;case e.$:throw new Error(`Unexpected end of segment at ${h.ye.position}`);default:throw new SyntaxError(`Unexpected token "${h.ye.name}" at column ${h.ye.position}`)}h.ye=this.stream.oe()}break;case e.p:if([e._,e.A,e.N].includes(this.stream.ce().type))break;default:h.ge=!1;continue}h.ye=this.stream.oe()}if(h.count!==parseInt(h.count))throw new Error(`The execution count (${h.count}) for segment "${w}" must be an integer.`);if(h.count<1)throw new Error(`The execution count (${h.count}) for segment "${w}" can't be less than 1.`);for(p=1;p<=h.count;p++)f=new a(new n(u)),f.parse(o,c,h.ve,h.Oe,p,h._e),c.stack.pop();h.ge=!1}}}class o{constructor(e){this.document=o.#E(e)}static#E(e){return(new("undefined"==typeof DOMParser?require("xmldom").DOMParser:DOMParser)).parseFromString(e,"text/xml")}#x(e,t){let i,a=[];for(;a.length||t.length;){a.length?i=a.pop():(i=t.shift(),i.previousSibling.tagName||""!==i.previousSibling.nodeValue.trim()||i.parentNode.removeChild(i.previousSibling),i.parentNode.removeChild(i));let o=new s(new n(i.getAttribute("value")));try{let t=o.parse(e,1,{},!1,null,r.K),n=i.getAttribute("id");if(n in e.unit)throw new Error(`Duplicate unit ID: "${n}"`);e.unit[n]=t.accumulator}catch(e){if(!(e instanceof ReferenceError))throw new Error("Couldn't parse item, "+e.message,{Ne:e});{if(1===a.filter((e=>e.getAttribute("id")===o.stream.se().name)).length)throw new ReferenceError(`Circular reference to "${o.stream.se().name}"`);a.push(i);let e=t.filter((e=>e.getAttribute("id")===o.stream.se().name));if(e.length>1)throw new ReferenceError(`Unable to resolve expression "${i.getAttribute("value")}". Duplicate ID "${o.stream.se().name}".`);if(0===e.length)throw new ReferenceError(`Unable to resolve expression "${i.getAttribute("value")}". "${o.stream.se().name}" is undefined.`);a.push(e[0]),e[0].parentNode.removeChild(e[0]),t=t.slice(0,t.indexOf(e[0])).concat(t.slice(t.indexOf(e[0])+1))}}}}#y(e,t){t.forEach((e=>{e.previousSibling.tagName||""!==e.previousSibling.nodeValue.trim()||e.parentNode.removeChild(e.previousSibling),e.parentNode.removeChild(e)})),e.be=t.reduce(((t,r)=>{let n=r.getAttribute("id");if(n in t)throw new Error(`Duplicate segment ID: "${n}"`);if(n in e.unit)throw new Error(`Segment ID: "${n}" already defined as a unit`);return t[r.getAttribute("id")]=r.getAttribute("d"),t}),{})}#g(e){let t,r=[];do{t=Array.from(this.document.getElementsByTagName("include")),t.forEach((t=>{let n=t.getAttribute("href");if(-1!==r.indexOf(n))throw new Error(`Circular include reference: ${n}`);r.push(n),n=n.split("#");let i=n[0],a=n.length>1?n.slice(1).join("#"):null;const s=require("fs").Se(e.Te+i,{encoding:"utf-8",Ue:"r"});let c,l=o.#E(s);if(null!==a){if(c=l.getElementById(a),!c)throw new Error(`Failed to include file: ${i}, ID: ${a}`)}else if(c=l.documentElement,!c)throw new Error(`Failed to include file: ${i}`);if("svg"===c.nodeName.toLowerCase()){let e=c.firstChild;for(;e;){let r=e;e=e.nextSibling,t.parentNode.insertBefore(r,t)}}else{let e=c;for(;e;){let r=e;e=e.nextSibling,t.parentNode.insertBefore(r,t)}}t.parentNode.removeChild(t)}))}while(t.length)}#b(e,t,r){const n=require("path");return r.filter((e=>e.hasAttribute("id"))).map((r=>{let i=e.cloneNode(!0),a=i.firstChild,s=null,o=[];for(;a;)if(!a.firstChild||o.includes(a.firstChild)){let e=a.nextSibling??a.parentNode;if(a.tagName&&a.hasAttribute("id"))if(a.getAttribute("id")!==r.getAttribute("id")||null!==s){let e=a.parentNode;a.previousSibling&&!a.previousSibling.tagName&&""===a.previousSibling.nodeValue.trim()&&e.removeChild(a.previousSibling),e.removeChild(a)}else null===s&&(s=a),o.push(a);else o.push(a);a=e}else a=a.firstChild;const c=[];for(;s&&!s.hasAttribute("dir");)c.push(s),s=s.parentNode;if(1===s.attributes.length&&s.parentNode){const e=s.parentNode;e.insertBefore(c[c.length-1],s),e.removeChild(s)}else s.removeAttribute("dir");return[t+(s?s.getAttribute("dir")+n.Ye:"")+r.getAttribute("id")+".svg",i]}))}transform(e){let t={unit:{},Ie:1,de:{path:{precision:e.precision,pe:e.Me},De:{Le:"xml"===e.Le||"all"===e.Le,Ce:e.Ce}}};this.#g(e),this.#x(t,Array.from(this.document.getElementsByTagName("unit")));for(let r in e.unit)t.unit[r]=e.unit[r];this.#y(t,Array.from(this.document.getElementsByTagName("segment")));let i=Array.from(this.document.getElementsByTagName("path"));for(t.Ie=0;i.length;){let e=i.shift(),r=new a(new n(e.getAttribute("d"))).parse(t);e.setAttribute("d",a.Ee(r,t.de.path.precision))}[{tagName:"svg",Be:[{name:"viewBox",qe:4},"width","height"]},{tagName:"rect",Be:["x","y","width","height","rx","ry"]},{tagName:"circle",Be:["r","cx","cy"]},{tagName:"ellipse",Be:["rx","ry","cx","cy"]},{tagName:"line",Be:["x1","y1","x2","y2"]},{tagName:"polygon",Be:[{name:"points",qe:-1}]},{tagName:"polyline",Be:[{name:"points",qe:-1}]},{tagName:"line",Be:["x1","y1","x2","y2"]},{tagName:"textPath",Be:["startOffset"]},{tagName:"image",Be:["x","y","width","height"]},{tagName:"marker",Be:["markerWidth","markerHeight","refX","refY"]}].forEach((e=>{for(i=Array.from(this.document.getElementsByTagName(e.tagName)),t.Ie=0;i.length;){let s=i.shift();e.Be.forEach((e=>{let i,o;if("string"==typeof e?(i=e,o=1):(i=e.name,o=e.qe),s.hasAttribute(i)){let e=new a(new n(s.getAttribute(i))).xe(t,r.Z(),o);s.setAttribute(i,a.Ee(e,t.de.path.precision))}}))}}));let s=[],o=this.document.documentElement.firstChild,c=8,l=3;for(;s.length||o;){o.firstChild&&s.push(o.firstChild);let e=o;o=o.nextSibling?o.nextSibling:s.pop(),t.de.De.Le&&e.nodeType===l&&0===e.nodeValue.replace(new RegExp("\\s+","g"),"").length&&e.parentNode.removeChild(e),t.de.De.Ce&&e.nodeType===c&&e.parentNode.removeChild(e)}if(e.ze){const t=require("path");let r=e.destination+t.Ye;i=this.#b(this.document.documentElement,r,Array.from(this.document.getElementsByTagName("*")))}else i=[[e.destination,this.document.documentElement]];return i.map((([e,t])=>[e,(new("undefined"==typeof XMLSerializer?require("xmldom").XMLSerializer:XMLSerializer)).serializeToString(t)]))}}!function(){let e=process.argv.slice(2),t=!0,r=!0,n=["path","xml","all"],i={Le:null,Ce:!1,Me:!1,precision:3};for(;r&&t&&e[0]&&e[0].startsWith("--");)switch(e[0]){case"--precision":i.precision=parseInt(e[1]),i.precision.toString()!==e[1]||isNaN(i.precision)?(console.log("Invalid syntax for --precision switch"),t=!1):e=e.slice(2);break;case"--stripWhitespace":i.Le=e[1],-1===n.indexOf(i.Le)?(console.log("Invalid syntax for --stripWhitespace switch"),t=!1):e=e.slice(2);break;case"--stripComments":i.Ce=!0,e.shift();break;case"--combinePathCommands":i.Me=!0,e.shift();break;case"--extract":i.ze=!0,e.shift();break;case"--":e.shift();default:r=!1}if(!t||e.length<2)console.log('\nUsage: npm start -- [options] <source> <destination> [units...]\n\nsource       An unprocessed SVG file containing Pather commands\ndestination  Desired filename of the processed output\noptions      One or more of the following switches:\n  --precision <n>                   Write numbers to the output with N decimal places. Default is 3\n  --stripWhitespace <path|xml|all>  Strip whitespace from within path data, between XML tags or both (all)\n  --stripComments                   Strip XML comments from the output document\n  --combinePathCommands             Combine repeated commands in path data, e.g. h 30 h 30 becomes h 60\n  --extract                         Extract all elements with an ID to individual files (destination is a directory)\nunits        Variable values to be passed to the Pather environment\n             Name/value pairs separated by "=", e.g. myUnit=3 myOtherUnit=4.2\n');else{let t=e.shift();for(i.destination=e.shift(),i.unit={},r=!0;r&&e.length;){let t,n=e.shift().split("=");switch(!0){case 2!==n.length:t=`Invalid unit format "${n.join("=")}".`;break;case null===new RegExp("^[bdefgijknopruwxy]|[a-z_$][a-z0-9_$]+$","i").exec(n[0]):t=`Invalid unit name "${n[0]}".`;break;case parseFloat(n[1]).toString()!==n[1].substr(0,parseFloat(n[1]).toString().length)||isNaN(parseFloat(n[1]))||parseFloat(n[1])===1/0||parseFloat(n[1])===-1/0:t=`Invalid unit value "${n[1]}".`}t?(console.log(`${t} Expected valid identifier followed by a number, e.g. myUnit=3`),r=!1):i.unit[n[0]]=parseFloat(n[1])}if(r){const e=require("fs"),r=require("path");i.Te=r.Fe(t)+r.Ye;const n=e.Se(t,{encoding:"utf-8",Ue:"r"});new o(n).transform(i).forEach((([t,n])=>{e.We(r.Fe(t))||e.Xe(r.Fe(t)),e.Ve(t,n,{encoding:"utf-8"})}))}}}()}));
//# sourceMappingURL=pather.min.js.map
