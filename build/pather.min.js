!function(e){"function"==typeof define&&define.amd?define(["fs"],e):e()}((function(){"use strict";class e{static i=1;static o=2;static u=3;static p=4;static R=5;static T=6;static $=7;static I=8;static P=9;static k=10;static O=11;static _=12;static A=13;static S=14;static N=15;static U=16;static M=17;static Y=18;constructor(e,t,n,r){this.type=e,this.name=t,this.value=n,this.position=r}}class t{static D=18;static PI=new t("3.141592653589793238");static#e=BigInt("1"+"0".repeat(t.D));static#t=new RegExp("\\.?0+$");#n;constructor(e=0){let n,r;e instanceof t?this.#n=e.#n:e instanceof BigInt?this.#n=value*t.L:([n,r]=(e+".").split("."),this.#n=BigInt(n+r.substr(0,t.D).padEnd(t.D,"0")),r.charCodeAt(t.D)>52&&this.#n++)}#r(e){let n;return n=new t(this),n.#n=e,n}#i(e,t){return this.#r(e/t+2n*e/t%2n)}add(e){return this.#r(this.#n+new t(e).#n)}C(e){return this.#r(this.#n-new t(e).#n)}B(e){return this.#i(this.#n*new t(e).#n,t.#e)}F(e){return this.#i(this.#n*t.#e,new t(e).#n)}equals(e){return this.valueOf()==e}valueOf(){return this.#n}W(){return+this.toString()}toString(e=t.D){let n;return n=this.#i(this.#n,BigInt("1"+"0".repeat(e>-1?Math.max(t.D-e,0):t.D))).#n.toString().padStart(e+1,"0"),n.substr(0,n.length-e)+("."+n.substr(-e)).replace(t.#t,"")}}class n{static V=1;static X=2;static G=3;static H=4;static K=5;static Z(){return{stack:[],j:[],J:null,pending:0,x:new t(0),y:new t(0),ee:!1,te:null,ne:new t(0),re:new t(0)}}}class r{static#s=[{type:e.i,ie:new RegExp("^[0-9]*\\.?[0-9]+",""),se:e=>new t(e)},{type:e.o,ie:new RegExp("^[achlmqstvz](?![a-z_$])","i"),se:e=>({a:[n.V,n.X,n.G,n.H,n.H,n.V,n.X],c:[n.V,n.X,n.V,n.X,n.V,n.X],h:[n.V],l:[n.V,n.X],m:[n.V,n.X],q:[n.V,n.X,n.V,n.X],s:[n.V,n.X,n.V,n.X],t:[n.V,n.X],v:[n.X],z:[]}[e.toLowerCase()])},{type:e.u,ie:new RegExp("^,+",""),se:()=>null},{type:e.p,ie:new RegExp("^\\s+",""),se:()=>null},{type:e.R,ie:new RegExp("^[a-z_$][a-z0-9_$]*","i"),se:e=>e},{type:e.T,ie:new RegExp("^[()]",""),se:e=>"("===e},{type:e.I,ie:new RegExp("^\\+",""),se:e=>e},{type:e.k,ie:new RegExp("^\\*",""),se:e=>e},{type:e.P,ie:new RegExp("^-",""),se:e=>e},{type:e.O,ie:new RegExp("^/",""),se:e=>e},{type:e._,ie:new RegExp("^%r",""),se:e=>e},{type:e.A,ie:new RegExp("^%h",""),se:e=>e},{type:e.S,ie:new RegExp("^%v",""),se:e=>e},{type:e.N,ie:new RegExp("^@",""),se:e=>e},{type:e.U,ie:new RegExp("^\\|",""),se:e=>e},{type:e.M,ie:new RegExp("^=",""),se:e=>e},{type:e.Y,ie:new RegExp("^#",""),se:e=>e}];#a=null;#o=0;constructor(t){var n,i,s,a;for(this.#a=[],i=0;t.length;){for(n=0;n<r.#s.length;n++)if(s=(a=r.#s[n]).ie.exec(t)){this.#a.push(new e(a.type,s[0],a.se(s[0]),i)),i+=s[0].length,t=t.substr(s[0].length);break}if(n===r.#s.length)throw new SyntaxError(`Unexpected symbol "${t.substr(0,1)}" at column ${i}`)}this.#a.push(new e(e.$,null,null,i))}ae(){return this.#a[this.#o]??null}oe(){return this.#o++,this.ae()}ce(){return this.#a[this.#o+1]??null}reset(){return this.#o=0,this.ae()}}class i{static le=0;static he=1;static ue=2;static we=3;static#c(e,t,n,r,i){var s,a;return n=n.C(e),r=r.C(t),i=i.W()%360*Math.PI/180,s=Math.cos(i),a=Math.sin(i),Math.abs(s-a)<2*Number.EPSILON?a=s:Math.abs(s+a)<2*Number.EPSILON&&(s=a),Math.abs(s)<Number.EPSILON&&(s=0),Math.abs(a)<Number.EPSILON&&(a=0),{x:e.add(n.B(s)).C(r.B(a)),y:t.add(r.B(s)).add(n.B(a))}}static#l(e,t,n,r,s,a){s===i.we?e.x=n.value:n.fixed&&(e.x=t?n.value.C(a.x):n.value),s===i.ue?e.y=r.value:r.fixed&&(e.y=t?r.value.C(a.y):r.value)}static fe(e,n,r,s,a){let o,c,l,h,u,w,f,p;if(l=n[0].toLowerCase(),h=n[0].toLowerCase()===n[0],o={x:h?new t(0):r.x,y:h?new t(0):r.y},r.pending)throw new SyntaxError(`Too few arguments for command ${n[0]}`);if(r.ee)throw new SyntaxError(`Dangling fix operator after command ${n[0]}`);switch(l){case"a":c={x:n[6].value,y:n[7].value},s!==i.le&&(c=i.#c(o.x,o.y,c.x,c.y,a)),i.#l(c,h,n[6],n[7],s,r),n=[n[0],n[1].value,n[2].value,n[3].fixed?n[3].value:n[3].value.add(a),n[4].value,n[5].value,c.x,c.y];break;case"c":u={x:n[1].value,y:n[2].value},w={x:n[3].value,y:n[4].value},c={x:n[5].value,y:n[6].value},s!==i.le&&(u=i.#c(o.x,o.y,u.x,u.y,a),w=i.#c(o.x,o.y,w.x,w.y,a),c=i.#c(o.x,o.y,c.x,c.y,a)),i.#l(c,h,n[5],n[6],s,r),n=[n[0],n[1].fixed?h?n[1].value.C(r.x):n[1].value:u.x,n[2].fixed?h?n[2].value.C(r.y):n[2].value:u.y,n[3].fixed?h?n[3].value.C(r.x):n[3].value:w.x,n[4].fixed?h?n[4].value.C(r.y):n[4].value:w.y,c.x,c.y];break;case"s":case"q":u={x:n[1].value,y:n[2].value},c={x:n[3].value,y:n[4].value},s!==i.le&&(u=i.#c(o.x,o.y,u.x,u.y,a),c=i.#c(o.x,o.y,c.x,c.y,a)),i.#l(c,h,n[3],n[4],s,r),n=[n[0],u.x,u.y,c.x,c.y];break;case"l":case"h":case"v":let d="v"===l?{value:new t(o.x),fixed:!0}:n[1],E="h"===l?{value:new t(o.y),fixed:!0}:"v"===l?n[1]:n[2];c={x:d.value,y:E.value},s!==i.le&&(c=i.#c(o.x,o.y,c.x,c.y,a)),p=180*Math.atan2(c.y.C(o.y).W(),c.x.C(o.x).W())/Math.PI,console.log("Before",c.x.toString(),c.y.toString(),s),i.#l(c,h,d,E,s,r),console.log("After",c.x.toString(),c.y.toString(),s),(n=c.x.equals(o.x)?c.y.equals(o.y)?null:["v",c.y]:c.y.equals(o.y)?["h",c.x]:["l",c.x,c.y])&&(e.de.path.pe&&r.j.length>0&&(f=r.j[r.j.length-1],f[0].toLowerCase()===n[0].toLowerCase()&&p===r.te&&(h?(f.length>2&&(f[2]=f[2].add(n[2])),f[1]=f[1].add(n[1]),n=null):r.Ee.pop())),r.te=p);break;case"m":case"t":c={x:n[1].value,y:n[2].value},s!==i.le&&(c=i.#c(o.x,o.y,c.x,c.y,a)),i.#l(c,h,n[1],n[2],s,r),n=[n[0],c.x,c.y],e.de.path.pe&&"m"===l&&r.j.length>0&&(f=r.j[r.j.length-1],"m"===f[0].toLowerCase()&&(h?(f[1]=f[1].add(n[1]),f[2]=f[2].add(n[2]),n=null):r.Ee.pop()));break;case"z":n=["z"],r.x=new t(r.ne),r.y=new t(r.re),r.te=null}"z"!==l&&(r.x=h?r.x.add(c.x):c.x,r.y=h?r.y.add(c.y):c.y),"m"===l&&(r.ne=new t(r.x),r.re=new t(r.y)),n&&(h||(n[0]=n[0].toUpperCase()),r.j.push(n))}}class s{constructor(e){this.stream=e}static me(e,n=t.D){return e.j.map((e=>e[0].toString()+(e.length>1?" "+e.slice(1).join(","):""))).join(" ")}xe(t,r=n.Z(),i){let s;for(s={ye:this.stream.ae(),Re:!0,index:0};s.Re&&s.ye&&s.index<i;){switch(s.ye.type){case e.p:case e.u:break;case e.$:s.Re=!1;break;default:let i=new a(this.stream).parse(t,0,[],!1,{x:r.x,y:r.y},n.K);r.j.push([i.accumulator]),r.index++,s.ye=this.stream.ae();continue}s.ye=this.stream.oe()}return r}parse(r,s=n.Z(),o=i.le,c=new t(0),l=1,h){let u,w,f,p;for(u={ye:this.stream.ae(),Re:!0};u.Re&&u.ye;){switch(u.ye.type){case e.o:if(null===s.J&&"m"!==u.ye.name.toLowerCase())throw new SyntaxError("Paths must begin with a Move To command");w&&i.fe(r,w,s,o,c),s.J=u.ye.value,s.pending=s.J.length,w=[u.ye.name];break;case e.N:s.ee=!0;break;case e.p:case e.u:break;case e.$:w&&i.fe(r,w,s,o,c),u.Re=!1;break;case e.R:case e.i:if(u.ye.type===e.i?(p=this.stream.ce(),f=p.type===e.R&&r.Te[p.name]):f=r.Te[u.ye.name],f){w&&(i.fe(r,w,s,o,c),w=null),new a(this.stream).ge(r,s,h),u.ye=this.stream.ae();continue}default:if(!w)throw new Error(`Expected command, but found "${u.ye.name}"`);if(s.pending||(i.fe(r,w,s,o,c),s.pending=s.J.length,w=[w[0]]),!s.pending)throw new SyntaxError(`Too many parameters supplied to command "${w[0]}"`);if("a"===w[0].toLowerCase()&&(4===s.pending||3===s.pending)&&u.ye.type===e.i&&u.ye.name.length>1&&-1!==["0","1"].indexOf(u.ye.name.substr(0,1)))w.push({fixed:s.ee,value:new t(u.ye.name.substr(0,1))}),u.ye.name=u.ye.name.substr(1),u.ye.value=new t(u.ye.name);else{let e=new a(this.stream).parse(r,0,h,!1,{x:s.x,y:s.y},s.J[s.J.length-s.pending]);w.push({fixed:s.ee,value:e.accumulator})}s.ee=!1,s.pending--,u.ye=this.stream.ae();continue}u.ye=this.stream.oe()}return s}}class a{static#h=1;static#u=2;static#w=3;static#f=4;static#p=5;constructor(e){this.stream=e,this.debug=!1}static#d(e){return e.value+" "+["","=","+","-","*","/"][e.operation]}static#E(e,t){var n,r,i;for(n=e.stack.length-1;n>-1&&e.stack[n].operation>t;)n--;if((r=n+1)<e.stack.length){for(e.stack.push({operation:a.#h,value:e.accumulator}),this.debug&&console.log("<<\n"+e.stack.slice(r).map(((e,t)=>t+": "+a.#d(e))).join("\n")),i=e.stack[r].value;r<e.stack.length-1;r++)switch(e.stack[r].operation){case a.#f:i=i.B(e.stack[r+1].value);break;case a.#p:i=i.F(e.stack[r+1].value);break;case a.#u:i=i.add(e.stack[r+1].value);break;case a.#w:i=i.C(e.stack[r+1].value)}e.accumulator=i,e.stack=e.stack.slice(0,n+1)}}parse(r,i=0,s={},o=!1,c,l,h=[]){var u,w;for(u={accumulator:new t(0),$e:0,be:i,data:0,stack:[]},w={ye:this.stream.ae(),Re:!0};w.Re&&w.ye;){switch(w.ye.type){case e.i:if(u.data===e.p)throw new SyntaxError(`Unexpected space-delimited value "${w.ye.name}" at column ${w.ye.position}`);if(u.data===e.i){if(u.be)throw new SyntaxError(`Unexpected token "${w.ye.name}" at column ${w.ye.position}`);w.Re=!1;continue}this.debug&&console.log("Number",w.ye),u.accumulator=w.ye.value,u.data=e.i;break;case e.O:if(u.data!==e.i&&u.data!==e.p)throw new SyntaxError(`Unexpected token "${w.ye.name}" at column ${w.ye.position}`);this.debug&&console.log("/",w.ye),u.stack.push({operation:a.#p,value:u.accumulator}),u.data=e.O;break;case e.k:if(u.data!==e.i&&u.data!==e.p)throw new SyntaxError(`Unexpected token "${w.ye.name}" at column ${w.ye.position}`);this.debug&&console.log("*",w.ye),u.stack.push({operation:a.#f,value:u.accumulator}),u.data=e.k;break;case e.P:if(u.data===e.i&&0===u.be){w.Re=!1;continue}if(u.data!==e.i&&0!==u.data&&u.data!==e.T&&u.data!==e.p)throw new SyntaxError(`Unexpected token "${w.ye.name}" at column ${w.ye.position}`);this.debug&&console.log("-",w.ye),a.#E(u,a.#w),u.stack.push({operation:a.#w,value:u.accumulator}),u.data=e.P;break;case e.I:if(u.data!==e.i&&u.data!==e.p)throw new SyntaxError(`Unexpected token "${w.ye.name}" at column ${w.ye.position}`);this.debug&&console.log("+",w.ye),a.#E(u,a.#w),u.stack.push({operation:a.#u,value:u.accumulator}),u.data=e.I;break;case e.U:if(u.data===e.p)throw new SyntaxError(`Unexpected space before measure operator ("${w.ye.name}") at column ${w.ye.position}`);if(u.data===e.i&&(this.debug&&console.log("*",w.ye),u.stack.push({operation:a.#f,value:u.accumulator})),l===n.K)throw new SyntaxError("The unit type is incompatible with the return value of a segment measurement");if(l===n.H)throw new SyntaxError("The flag type is incompatible with the return value of a segment measurement");if(this.stream.oe(),this.stream.ae().type===e.p&&this.stream.oe(),this.stream.ae().type!==e.R)throw new SyntaxError(`Expected identifier at ${this.stream.ae().position}, found "${this.stream.ae().name}"`);let i=n.Z();switch(i.x=c.x,i.y=c.y,i.J=[],new a(this.stream).ge(r,i,s),u.data=e.i,l){case n.V:u.accumulator=i.x.C(c.x),console.log("RETURNING X",u.accumulator.toString());break;case n.X:u.accumulator=i.y.C(c.y),console.log("RETURNING Y",u.accumulator.toString());break;case n.G:u.accumulator=new t(Math.atan2(i.x.C(c.x).W(),i.y.C(c.y).W())).B(180).F(t.PI),console.log("RETURNING THETA",u.accumulator.toString())}if(this.stream.ae().type===e.p&&this.stream.oe(),w.ye=this.stream.ae(),w.ye.type!==e.U)throw new SyntaxError(`Expected measurement operator, found "${w.ye.name}`);break;case e.T:if(this.debug&&console.log(w.ye.value?"(":")",w.ye,u.be,r.Ie),w.ye.value){if(u.data===e.p)throw new SyntaxError(`Unexpected token "${w.ye.name}" at column ${w.ye.position}`);u.be++,u.data===e.i&&(this.debug&&console.log("*",w.ye),u.stack.push({operation:a.#f,value:u.accumulator})),u.accumulator=new t(0),u.stack.push({operation:a.#h}),u.data=e.T}else{if(!o&&u.be===r.Ie)throw new SyntaxError(`Mismatched bracket at column ${w.ye.position}`);if(u.data!==e.i)throw new SyntaxError(`Unexpected bracket at column ${w.ye.position}`);if(a.#E(u,a.#h),u.stack.pop(),u.data=e.i,o){w.Re=!1;continue}u.be--}break;case e.R:if(u.data===e.p)throw new SyntaxError(`Unexpected space-delimited value "${w.ye.name}" at column ${w.ye.position}`);if(!(w.ye.name in s)&&!(w.ye.name in r.unit))throw new ReferenceError(`Reference to undefined unit "${w.ye.name}" at column ${w.ye.position}.`);u.data===e.i&&(this.debug&&console.log("*",w.ye),u.stack.push({operation:a.#f,value:u.accumulator})),this.debug&&console.log("Unit",w.ye),u.accumulator=s[w.ye.name]??r.unit[w.ye.name],u.data=e.i;break;case e.u:if(u.be)throw new SyntaxError(`Unexpected delimiter "${w.ye.name}" in expression at column ${w.ye.position}.`);case e.p:if(u.be||0===u.data){u.data===e.i&&(u.data=e.p);break}case e.$:if(u.be>r.Ie)throw new SyntaxError(`Missing closing bracket(s) at end of segment (nesting depth = ${u.be-r.Ie})`);w.Re=!1;continue;default:if(h.includes(w.ye.type)){w.Re=!1;continue}throw new SyntaxError(`Unexpected token "${w.ye.name}" at column ${w.ye.position}`)}w.ye=this.stream.oe()}return a.#E(u,a.#w),a.#E(u,0),u}ge(o,c,l){let h,u,w,f,p,d,E;if(h={ye:this.stream.ae(),Re:!0,Pe:!1,ve:!1,ke:new t(0),Oe:i.le,count:!1,_e:{},Ae:!1},h.ye.type===e.i?(h.count=h.ye.value.W(),h.Pe=!0,h.ye=this.stream.oe()):h.count=1,f=h.ye.name,-1!==c.stack.indexOf(f))throw new ReferenceError(`Segment ${h.ye.name} cannot call itself`);{if(!(f in o.Te))throw new ReferenceError(`Reference to undefined section "${f}" at ${h.ye.position}`);u=o.Te[f];const t=f;for(h.ye=this.stream.oe();!0===h.Re&&h.ye;){switch(h.ye.type){case e._:case e.A:case e.S:if(h.Oe!==i.le)throw new Error(`Encountered distortion operator, but distortion for segment "${f}" is already specified (parameter value: ${h.ke})`);this.stream.oe(),d=new a(this.stream).parse(o,0,l,!1,{x:c.x,y:c.y},n.G,[e._,e.A,e.S]),h.ke=d.accumulator,h.Oe={[e._]:i.he,[e.A]:i.ue,[e.S]:i.we}[h.ye.type],h.ye=this.stream.ae();continue;case e.T:if(h.ve){h.Re=!1;continue}if(!h.ye.value)throw new SyntaxError(`Unexpected token "${h.ye.name}" at column ${h.ye.position}`);for(h.ye=this.stream.oe();!h.ve;){switch(h.ye.type){case e.T:if(h.ye.value)throw new SyntaxError(`Unexpected token "${h.ye.name}" at column ${h.ye.position}`);h.ve=!0;continue;case e.R:case e._:case e.Y:case e.A:case e.S:switch(h.Ae=!1,f=h.ye.name,E=h.ye.type,E){case e.R:if(o.Te[f])throw new ReferenceError(`Argument "${f}" is already defined as a segment`);break;case e._:case e.A:case e.S:if(h.Oe!==i.le)throw new Error(`Encountered distortion operator, but distortion for segment "${t}" is already specified (parameter value: ${h.ke})`);break;case e.Y:if(h.Pe)throw new ReferenceError("Execution count is already defined for this invocation")}if(this.stream.ce().type===e.p&&(h.ye=this.stream.oe()),h.ye=this.stream.oe(),h.ye.type===e.$)throw new Error(`Unexpected end of segment at ${h.ye.position}`);if(h.ye.type!==e.M)throw new SyntaxError(`Expected assignment operator after argument name, but found "${h.ye.name}"`);switch(h.ye=this.stream.oe(),d=new a(this.stream).parse(o,0,l,!0,{x:c.x,y:c.y},{[e.R]:n.K,[e._]:n.G,[e.A]:n.G,[e.S]:n.G,[e.Y]:n.K}[E]),E){case e.R:h._e[f]=d.accumulator;break;case e._:case e.A:case e.S:h.ke=d.accumulator,h.Oe={[e._]:i.he,[e.A]:i.ue,[e.S]:i.we}[E];break;case e.Y:h.count=d.accumulator.W(),h.Pe=!0}h.ye=this.stream.ae();continue;case e.u:if(h.Ae)throw new Error(`Unexpected delimiter at column ${h.ye.position}`);h.Ae=!0;case e.p:break;case e.$:throw new Error(`Unexpected end of segment at ${h.ye.position}`);default:throw new SyntaxError(`Unexpected token "${h.ye.name}" at column ${h.ye.position}`)}h.ye=this.stream.oe()}break;case e.p:if(this.stream.ce().type===e._)break;default:h.Re=!1;continue}h.ye=this.stream.oe()}if(h.count!==parseInt(h.count))throw new Error(`The execution count (${h.count}) for segment "${f}" must be an integer.`);if(h.count<1)throw new Error(`The execution count (${h.count}) for segment "${f}" can't be less than 1.`);for(p=1;p<=h.count;p++)w=new s(new r(u)),w.parse(o,c,h.Oe,h.ke,p,h._e),c.stack.pop();h.Re=!1}}}class o{constructor(e){this.document=o.#m(e)}static#m(e){return(new("undefined"==typeof DOMParser?require("xmldom").DOMParser:DOMParser)).parseFromString(e,"text/xml")}#x(e,t){let i,s=[];for(;s.length||t.length;){s.length?i=s.pop():(i=t.shift(),i.parentNode.removeChild(i));let o=new a(new r(i.getAttribute("value")));try{let t=o.parse(e,1,{},!1,null,n.K),r=i.getAttribute("id");if(r in e.unit)throw new Error(`Duplicate unit ID: "${r}"`);e.unit[r]=t.accumulator}catch(e){if(!(e instanceof ReferenceError))throw new Error("Couldn't parse item, "+e.message,{Se:e});{if(1===s.filter((e=>e.getAttribute("id")===o.stream.ae().name)).length)throw new ReferenceError(`Circular reference to "${o.stream.ae().name}"`);s.push(i);let e=t.filter((e=>e.getAttribute("id")===o.stream.ae().name));if(e.length>1)throw new ReferenceError(`Unable to resolve expression "${i.getAttribute("value")}". Duplicate ID "${o.stream.ae().name}".`);if(0===e.length)throw new ReferenceError(`Unable to resolve expression "${i.getAttribute("value")}". "${o.stream.ae().name}" is undefined.`);s.push(e[0]),e[0].parentNode.removeChild(e[0]),t=t.slice(0,t.indexOf(e[0])).concat(t.slice(t.indexOf(e[0])+1))}}}}#y(e,t){t.forEach((e=>e.parentNode.removeChild(e))),e.Te=t.reduce(((t,n)=>{let r=n.getAttribute("id");if(r in t)throw new Error(`Duplicate segment ID: "${r}"`);if(r in e.unit)throw new Error(`Segment ID: "${r}" already defined as a unit`);return t[n.getAttribute("id")]=n.getAttribute("d"),t}),{})}#R(e){let t,n=[];do{t=Array.from(this.document.getElementsByTagName("include")),t.forEach((t=>{let r=t.getAttribute("href");if(-1!==n.indexOf(r))throw new Error(`Circular include reference: ${r}`);n.push(r),r=r.split("#");let i=r[0],s=r.length>1?r.slice(1).join("#"):null;const a=require("fs").Ne(e.$e+i,{encoding:"utf-8",Ue:"r"});let c,l=o.#m(a);if(null!==s){if(c=l.getElementById(s),!c)throw new Error(`Failed to include file: ${i}, ID: ${s}`)}else if(c=l.documentElement,!c)throw new Error(`Failed to include file: ${i}`);if("svg"===c.nodeName.toLowerCase()){let e=c.firstChild;for(;e;){let n=e;e=e.nextSibling,t.parentNode.insertBefore(n,t)}}else t.parentNode.insertBefore(c,t);t.parentNode.removeChild(t)}))}while(t.length)}#T(e,t,n){const r=require("path");return n.filter((e=>e.hasAttribute("id"))).map((n=>{let i=e.cloneNode(!0),s=i.firstChild,a=null,o=[];for(;s;)if(!s.firstChild||o.includes(s.firstChild)){let e=s.nextSibling??s.parentNode;if(s.tagName&&s.hasAttribute("id"))if(s.getAttribute("id")!==n.getAttribute("id")||null!==a){let e=s.parentNode;s.previousSibling&&!s.previousSibling.tagName&&e.removeChild(s.previousSibling),e.removeChild(s)}else null===a&&(a=s),o.push(s);else o.push(s);s=e}else s=s.firstChild;const c=[];for(;a&&!a.hasAttribute("dir");)c.push(a),a=a.parentNode;if(1===a.attributes.length&&a.parentNode){const e=a.parentNode;e.insertBefore(c[c.length-1],a),e.removeChild(a)}else a.removeAttribute("dir");return[t+(a?a.getAttribute("dir")+r.Me:"")+n.getAttribute("id")+".svg",i]}))}transform(e){let t={unit:{},Ie:1,de:{path:{precision:e.precision,pe:e.Ye},De:{Le:"xml"===e.Le||"all"===e.Le,Ce:e.Ce}}};this.#R(e),this.#x(t,Array.from(this.document.getElementsByTagName("unit")));for(let n in e.unit)t.unit[n]=e.unit[n];this.#y(t,Array.from(this.document.getElementsByTagName("segment")));let i=Array.from(this.document.getElementsByTagName("path"));for(t.Ie=0;i.length;){let e=i.shift(),n=new s(new r(e.getAttribute("d"))).parse(t);e.setAttribute("d",s.me(n,t.de.path.precision))}for(i=Array.from(this.document.getElementsByTagName("svg")),t.Ie=0;i.length;){let e=i.shift();if(e.hasAttribute("viewBox")){let i=new s(new r(e.getAttribute("viewBox"))).xe(t,n.Z(),4);e.setAttribute("viewBox",s.me(i,t.de.path.precision))}}let a=[],o=this.document.documentElement.firstChild,c=8,l=3;for(;a.length||o;){o.firstChild&&a.push(o.firstChild);let e=o;o=o.nextSibling?o.nextSibling:a.pop(),t.de.De.Le&&e.nodeType===l&&0===e.nodeValue.replace(new RegExp("\\s+","g"),"").length&&e.parentNode.removeChild(e),t.de.De.Ce&&e.nodeType===c&&e.parentNode.removeChild(e)}if(e.Be){const t=require("path");let n=e.destination+t.Me;i=this.#T(this.document.documentElement,n,Array.from(this.document.getElementsByTagName("*")))}else i=[[e.destination,this.document.documentElement]];return i.map((([e,t])=>[e,(new("undefined"==typeof XMLSerializer?require("xmldom").XMLSerializer:XMLSerializer)).serializeToString(t)]))}}!function(){let e=process.argv.slice(2),t=!0,n=!0,r=["path","xml","all"],i={Le:null,Ce:!1,Ye:!1,precision:3};for(;n&&t&&e[0]&&e[0].startsWith("--");)switch(e[0]){case"--precision":i.precision=parseInt(e[1]),i.precision.toString()!==e[1]||isNaN(i.precision)?(console.log("Invalid syntax for --precision switch"),t=!1):e=e.slice(2);break;case"--stripWhitespace":i.Le=e[1],-1===r.indexOf(i.Le)?(console.log("Invalid syntax for --stripWhitespace switch"),t=!1):e=e.slice(2);break;case"--stripComments":i.Ce=!0,e.shift();break;case"--combinePathCommands":i.Ye=!0,e.shift();break;case"--extract":i.Be=!0,e.shift();break;case"--":e.shift();default:n=!1}if(!t||e.length<2)console.log('\nUsage: npm start -- [options] <source> <destination> [units...]\n\nsource       An unprocessed SVG file containing Pather commands\ndestination  Desired filename of the processed output\noptions      One or more of the following switches:\n  --precision <n>                   Write numbers to the output with N decimal places. Default is 3\n  --stripWhitespace <path|xml|all>  Strip whitespace from within path data, between XML tags or both (all)\n  --stripComments                   Strip XML comments from the output document\n  --combinePathCommands             Combine repeated commands in path data, e.g. h 30 h 30 becomes h 60\n  --extract                         Extract all elements with an ID to individual files (destination is a directory)\nunits        Variable values to be passed to the Pather environment\n             Name/value pairs separated by "=", e.g. myUnit=3 myOtherUnit=4.2\n');else{let t=e.shift();for(i.destination=e.shift(),i.unit={},n=!0;n&&e.length;){let t,r=e.shift().split("=");switch(!0){case 2!==r.length:t=`Invalid unit format "${r.join("=")}".`;break;case null===new RegExp("^[bdefgijknopruwxy]|[a-z_$][a-z0-9_$]+$","i").exec(r[0]):t=`Invalid unit name "${r[0]}".`;break;case parseFloat(r[1]).toString()!==r[1].substr(0,parseFloat(r[1]).toString().length)||isNaN(parseFloat(r[1]))||parseFloat(r[1])===1/0||parseFloat(r[1])===-1/0:t=`Invalid unit value "${r[1]}".`}t?(console.log(`${t} Expected valid identifier followed by a number, e.g. myUnit=3`),n=!1):i.unit[r[0]]=parseFloat(r[1])}if(n){const e=require("fs"),n=require("path");i.$e=n.qe(t)+n.Me;const r=e.Ne(t,{encoding:"utf-8",Ue:"r"});new o(r).transform(i).forEach((([t,r])=>{e.ze(n.qe(t))||e.Fe(n.qe(t)),e.We(t,r,{encoding:"utf-8"})}))}}}()}));
//# sourceMappingURL=pather.min.js.map
